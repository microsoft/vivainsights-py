<!doctype html>
<html class="no-js" lang="en" data-content_root="../../">
  <head><meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="color-scheme" content="light dark"><link rel="author" title="About these documents" href="../../about.html"><link rel="index" title="Index" href="../../genindex.html"><link rel="search" title="Search" href="../../search.html">
        <link rel="prefetch" href="../../_static/vivainsights-py.png" as="image">

    <link rel="shortcut icon" href="../../_static/favicon.svg"><!-- Generated with Sphinx 7.4.7 and Furo 2025.12.19 -->
        <title>vivainsights.network_p2p - vivainsights 0.4.2 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=d111a655" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=7bdb33bb" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=8dab3a3b" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=ac958071" />
    
    


<style>
  body {
    --color-code-background: #f2f2f2;
  --color-code-foreground: #1e1e1e;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle site navigation sidebar">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc" aria-label="Toggle table of contents sidebar">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <span class="icon"><svg><use href="#svg-menu"></use></svg></span>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">vivainsights 0.4.2 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../../_static/vivainsights-py.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">vivainsights 0.4.2 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../about.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about.html#quick-start">Quick start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about.html#visualization-gallery">Visualization Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about.html#related-repositories">Related repositories</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about.html#contributing">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about.html#license">License</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../modules.html">vivainsights</a><input aria-label="Toggle navigation of vivainsights" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../vivainsights.html">Reference - Functions</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../vivainsights.html#visualization-functions">Visualization Functions</a><input aria-label="Toggle navigation of Visualization Functions" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/vivainsights.create_bar.html">vivainsights.create_bar</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/vivainsights.create_boxplot.html">vivainsights.create_boxplot</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/vivainsights.create_bubble.html">vivainsights.create_bubble</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/vivainsights.create_line.html">vivainsights.create_line</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/vivainsights.create_rank.html">vivainsights.create_rank</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/vivainsights.create_trend.html">vivainsights.create_trend</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/vivainsights.create_sankey.html">vivainsights.create_sankey</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/vivainsights.create_lorenz.html">vivainsights.create_lorenz</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/vivainsights.create_inc.html">vivainsights.create_inc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/vivainsights.create_bar_asis.html">vivainsights.create_bar_asis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/vivainsights.create_IV.html">vivainsights.create_IV</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/vivainsights.create_odds_ratios.html">vivainsights.create_odds_ratios</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../vivainsights.html#data-analysis-identification">Data Analysis &amp; Identification</a><input aria-label="Toggle navigation of Data Analysis &amp; Identification" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/vivainsights.identify_churn.html">vivainsights.identify_churn</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/vivainsights.identify_tenure.html">vivainsights.identify_tenure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/vivainsights.identify_habit.html">vivainsights.identify_habit</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/vivainsights.identify_usage_segments.html">vivainsights.identify_usage_segments</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/vivainsights.identify_outlier.html">vivainsights.identify_outlier</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/vivainsights.identify_inactiveweeks.html">vivainsights.identify_inactiveweeks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/vivainsights.identify_holidayweeks.html">vivainsights.identify_holidayweeks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/vivainsights.identify_nkw.html">vivainsights.identify_nkw</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/vivainsights.identify_daterange.html">vivainsights.identify_daterange</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/vivainsights.extract_date_range.html">vivainsights.extract_date_range</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../vivainsights.html#network-analysis">Network Analysis</a><input aria-label="Toggle navigation of Network Analysis" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/vivainsights.network_g2g.html">vivainsights.network_g2g</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/vivainsights.network_p2p.html">vivainsights.network_p2p</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/vivainsights.network_summary.html">vivainsights.network_summary</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../vivainsights.html#data-management">Data Management</a><input aria-label="Toggle navigation of Data Management" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/vivainsights.pq_data.html">vivainsights.pq_data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/vivainsights.mt_data.html">vivainsights.mt_data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/vivainsights.g2g_data.html">vivainsights.g2g_data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/vivainsights.p2p_data.html">vivainsights.p2p_data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/vivainsights.p2g_data.html">vivainsights.p2g_data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/vivainsights.p2p_data_sim.html">vivainsights.p2p_data_sim</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/vivainsights.import_query.html">vivainsights.import_query</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/vivainsights.export.html">vivainsights.export</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../vivainsights.html#utility-functions">Utility Functions</a><input aria-label="Toggle navigation of Utility Functions" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/vivainsights.extract_hr.html">vivainsights.extract_hr</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/vivainsights.hrvar_count.html">vivainsights.hrvar_count</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/vivainsights.totals_col.html">vivainsights.totals_col</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/vivainsights.us_to_space.html">vivainsights.us_to_space</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/vivainsights.check_inputs.html">vivainsights.check_inputs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/vivainsights.color_codes.html">vivainsights.color_codes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/vivainsights.xicor.html">vivainsights.xicor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../_autosummary/vivainsights.keymetrics_scan.html">vivainsights.keymetrics_scan</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../demo-vivainsights-py.html">Demo Notebook for the vivainsights Python package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../demo-create_odds_ratios.html">Demo: Using <code class="docutils literal notranslate"><span class="pre">create_odds_ratios</span></code> from the vivainsights Python Package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NEWS.html">Version 0.4.2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NEWS.html#version-0-4-1">Version 0.4.1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NEWS.html#version-0-4-0">Version 0.4.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NEWS.html#version-0-3-4">Version 0.3.4</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NEWS.html#version-0-3-3">Version 0.3.3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NEWS.html#version-0-3-2">Version 0.3.2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NEWS.html#version-0-3-1">Version 0.3.1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NEWS.html#version-0-3-0">Version 0.3.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NEWS.html#version-0-2-4">Version 0.2.4</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NEWS.html#version-0-2-3">Version 0.2.3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NEWS.html#version-0-2-2">Version 0.2.2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NEWS.html#version-0-2-1">Version 0.2.1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NEWS.html#version-0-2-0">Version 0.2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NEWS.html#version-0-1-0">Version 0.1.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CONTRIBUTORS.html">Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../SECURITY.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../SECURITY.html#reporting-security-issues">Reporting Security Issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../SECURITY.html#preferred-languages">Preferred Languages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../SECURITY.html#policy">Policy</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <h1>Source code for vivainsights.network_p2p</h1><div class="highlight"><pre>
<span></span><span class="c1"># --------------------------------------------------------------------------------------------</span>
<span class="c1"># Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c1"># Licensed under the MIT License. See LICENSE.txt in the project root for license information.</span>
<span class="c1"># --------------------------------------------------------------------------------------------</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module performs network analysis with a person-to-person query</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;network_p2p&#39;</span><span class="p">]</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">vivainsights</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">vi</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">igraph</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ig</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.colors</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mcolors</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.legend_handler</span><span class="w"> </span><span class="kn">import</span> <span class="n">HandlerTuple</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.lines</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mlines</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.backends.backend_pdf</span><span class="w"> </span><span class="kn">import</span> <span class="n">PdfPages</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">minmax_scale</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<div class="viewcode-block" id="network_p2p">
<a class="viewcode-back" href="../../_autosummary/vivainsights.network_p2p.html#vivainsights.network_p2p.network_p2p">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">network_p2p</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> 
    <span class="n">hrvar</span> <span class="o">=</span> <span class="s2">&quot;Organization&quot;</span><span class="p">,</span>
    <span class="n">return_type</span> <span class="o">=</span> <span class="s2">&quot;plot&quot;</span><span class="p">,</span>
    <span class="n">centrality</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">community</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">weight</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">comm_args</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">layout</span> <span class="o">=</span> <span class="s2">&quot;mds&quot;</span><span class="p">,</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">style</span> <span class="o">=</span> <span class="s2">&quot;igraph&quot;</span><span class="p">,</span>
    <span class="n">bg_fill</span> <span class="o">=</span> <span class="s2">&quot;#FFFFFF&quot;</span><span class="p">,</span>
    <span class="n">font_col</span> <span class="o">=</span> <span class="s2">&quot;grey20&quot;</span><span class="p">,</span>
    <span class="n">legend_pos</span> <span class="o">=</span> <span class="s2">&quot;best&quot;</span><span class="p">,</span>
    <span class="n">palette</span> <span class="o">=</span> <span class="s2">&quot;rainbow&quot;</span><span class="p">,</span>
    <span class="n">node_alpha</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">,</span>
    <span class="n">edge_alpha</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">edge_col</span> <span class="o">=</span> <span class="s2">&quot;#777777&quot;</span><span class="p">,</span>
    <span class="n">node_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span>
    <span class="n">node_scale</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">legend_ncols</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">figsize</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Name</span>
<span class="sd">    ----</span>
<span class="sd">    network_p2p</span>

<span class="sd">    Description</span>
<span class="sd">    ------------</span>
<span class="sd">    This function returns a network plot given a data frame containing a person-to-person query.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : dataframe </span>
<span class="sd">        Data frame containing a person-to-person query.</span>
<span class="sd">    hrvar : str </span>
<span class="sd">        String containing the label for the HR attribute.</span>
<span class="sd">    return_type : str </span>
<span class="sd">        A different output is returned depending on the value passed to the `return_type` argument: </span>
<span class="sd">        - `&#39;plot&#39;` (default)</span>
<span class="sd">        - `&#39;plot-pdf&#39;`</span>
<span class="sd">        - `&#39;sankey&#39;`</span>
<span class="sd">        - `&#39;table&#39;`</span>
<span class="sd">        - `&#39;data&#39;`</span>
<span class="sd">        - `&#39;network&#39;`</span>

<span class="sd">    centrality : str </span>
<span class="sd">        string to determines which centrality measure is used to scale the size of the nodes. All centrality measures are automatically calculated when it is set to one of the below values, and reflected in the `&#39;network&#39;` and `&#39;data&#39;` outputs. </span>
<span class="sd">        Measures include: </span>
<span class="sd">        - `betweenness`</span>
<span class="sd">        - `closeness`</span>
<span class="sd">        - `degree`</span>
<span class="sd">        - `eigenvector`</span>
<span class="sd">        - `pagerank`</span>
<span class="sd">        When `centrality` is set to None, no centrality is calculated in the outputs and all the nodes would have the same size. </span>

<span class="sd">    community : str </span>
<span class="sd">        String determining which community detection algorithms to apply. Valid values include: </span>
<span class="sd">        - `None` (default): compute analysis or visuals without computing communities.</span>
<span class="sd">        - `&quot;multilevel&quot;` (a version of louvain)</span>
<span class="sd">        - `&quot;leiden&quot;`</span>
<span class="sd">        - `&quot;edge_betweenness&quot;`</span>
<span class="sd">        - `&quot;fastgreedy&quot;`</span>
<span class="sd">        - `&quot;infomap&quot;`</span>
<span class="sd">        - `&quot;label_propagation&quot;`</span>
<span class="sd">        - `&quot;leading_eigenvector&quot;`</span>
<span class="sd">        - `&quot;optimal_modularity&quot;`</span>
<span class="sd">        - `&quot;spinglass&quot;`</span>
<span class="sd">        - `&quot;walk_trap&quot;`</span>

<span class="sd">    weight : str </span>
<span class="sd">        String to specify which column to use as weights for the network. To create a graph without weights, supply `None` to this argument.</span>
<span class="sd">    comm_args : list</span>
<span class="sd">        list containing the arguments to be passed through to igraph&#39;s clustering algorithms. Arguments must be named. See examples section on how to supply arguments in a named list.</span>
<span class="sd">    layout : str</span>
<span class="sd">        String to specify the node placement algorithm to be used. Defaults to `&quot;mds&quot;` for the deterministic multi-dimensional scaling of nodes. </span>
<span class="sd">        See &lt;https://rdrr.io/cran/ggraph/man/layout_tbl_graph_igraph.html&gt; for a full  list of options.</span>
<span class="sd">    path : str (file path)</span>
<span class="sd">        File path for saving the PDF output. Defaults to a timestamped path based on current parameters.</span>
<span class="sd">        </span>
<span class="sd">    bg_fill : str </span>
<span class="sd">        String to specify background fill color.</span>
<span class="sd">    font_col : str</span>
<span class="sd">        String to specify font color.</span>
<span class="sd">    legend_pos : str</span>
<span class="sd">        String to specify position of legend. Valid values include:  </span>
<span class="sd">        String to specify position of legend. Valid values include: </span>
<span class="sd">        - `&quot;best&quot;`</span>
<span class="sd">        - `&quot;upper right&quot;`</span>
<span class="sd">        - `&quot;upper left&quot;`</span>
<span class="sd">        - `&quot;lower left&quot;`</span>
<span class="sd">        - `&quot;right&quot;`</span>
<span class="sd">        -  `&quot;center left&quot;`</span>
<span class="sd">        - `&quot;center right&quot;`</span>
<span class="sd">        - `&quot;lower center&quot;`</span>
<span class="sd">        - `&quot;upper center&quot;`</span>
<span class="sd">        - `&quot;center&quot;`</span>
<span class="sd">    palette : str </span>
<span class="sd">        String specifying the function to generate a color palette with a single argument `n`. Uses `&quot;rainbow&quot;` by default.</span>
<span class="sd">    node_alpha : int </span>
<span class="sd">        A numeric value between 0 and 1 to specify the transparency of the nodes. Defaults to 0.7.</span>
<span class="sd">    :param edge_alpha : int</span>
<span class="sd">        A numeric value between 0 and 1 to specify the transparency of the edges (only for &#39;ggraph&#39; mode). Defaults to 1.</span>
<span class="sd">    edge_col: String to specify edge link color.</span>
<span class="sd">    node_sizes: int</span>
<span class="sd">        Numeric vector of length two to specify the range of node sizes to rescale to, when `centrality` is set to a non-null value.</span>
<span class="sd">    node_scale: int</span>
<span class="sd">        A numeric value to multiply or divide the size of the nodes. </span>
<span class="sd">        This is applied to the &#39;node_size&#39; attribute in the graph to increase or decrease the size of the nodes.</span>
<span class="sd">    seed : int</span>
<span class="sd">        Seed for the random number generator passed to either `set.seed()` when the louvain or leiden community detection algorithm is used, to ensure consistency. Only applicable when `community` is set to one of the valid non-null values.</span>
<span class="sd">    legend_ncols : int</span>
<span class="sd">        Value is either 0 or 1, Parameter to change the orientation horizontal to vertical of legend in the plot.</span>
<span class="sd">    figsize : tuple</span>
<span class="sd">        The `figsize` parameter is an optional tuple that specifies the size of the figure for the boxplot visualization. It should be in the format `(width, height)`, where `width` and `height` are in inches. If not provided, a default size of (8, 6) will be used.</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    A different output is returned depending on the value passed to the `return_type` argument:     </span>
<span class="sd">    - `&#39;plot&#39;`: return a network plot, interactively within R.</span>
<span class="sd">    - `&#39;plot-pdf&#39;`: save a network plot as PDF. This option is recommended when the graph is large, which make take a long time to run if `return_type = &#39;plot&#39;` is selected. Use this together with `path` to control the save location.</span>
<span class="sd">    - `&#39;sankey&#39;`: return a sankey plot combining communities and HR attribute. This is only valid if a community detection method is selected at community`.</span>
<span class="sd">    - `&#39;table&#39;`: return a vertex summary table with counts in communities and HR attribute. When `centrality` is non-NULL, the average centrality values are calculated per group.</span>
<span class="sd">    - `&#39;data&#39;`: return a vertex data file that matches vertices with communities and HR attributes.</span>
<span class="sd">    - `&#39;network&#39;`: return &#39;igraph&#39; object.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import vivainsights as vi</span>
<span class="sd">    &gt;&gt;&gt; sample_data = vi.p2p_data_sim()</span>
<span class="sd">    &gt;&gt;&gt; # Return a network visual</span>
<span class="sd">    &gt;&gt;&gt; vi.network_p2p(data = sample_data, return_type = &quot;plot&quot;)</span>

<span class="sd">    &gt;&gt;&gt;  # Return the vertex table with counts in communities and HR attribute</span>
<span class="sd">    &gt;&gt;&gt; # Resolution is set to a low value to yield fewer communities</span>
<span class="sd">    &gt;&gt;&gt; vi.network_p2p(data = sample_data, community = &quot;leiden&quot;, comm_args = {&quot;resolution&quot;: 0.01}, return_type = &quot;table&quot;)</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; # Return the vertex table with centrality calculations</span>
<span class="sd">    &gt;&gt;&gt; vi.network_p2p(data = sample_data, centrality = &quot;betweenness&quot;, return_type = &quot;table&quot;)</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; vi.network_p2p(</span>
<span class="sd">    &gt;&gt;&gt;    data = sample_data, # or whatever your query is stored</span>
<span class="sd">    &gt;&gt;&gt;    node_scale = 50, # adjust this parameter to make nodes bigger/smaller</span>
<span class="sd">    &gt;&gt;&gt;    return_type = &quot;plot&quot;</span>
<span class="sd">    &gt;&gt;&gt;    )</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; # Return the sankey output based on centrality and community</span>
<span class="sd">    &gt;&gt;&gt; vi.network_p2p(</span>
<span class="sd">    &gt;&gt;&gt;    data = sample_data, # or whatever your query is stored</span>
<span class="sd">    &gt;&gt;&gt;    return_type = &quot;sankey&quot;, # another return type for visualization </span>
<span class="sd">    &gt;&gt;&gt;    centrality = &quot;betweenness&quot;, # centrality can be set as per requirement</span>
<span class="sd">    &gt;&gt;&gt;    community = &quot;leiden&quot; # Adjust community </span>
<span class="sd">    &gt;&gt;&gt;    )</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; # Return the plot output based on different color scheme, legend orientation and position, font color change</span>
<span class="sd">    &gt;&gt;&gt; vi.network_p2p(</span>
<span class="sd">    &gt;&gt;&gt;    data = sample_data, # or whatever your query is stored</span>
<span class="sd">    &gt;&gt;&gt;    return_type = &quot;plot&quot;,</span>
<span class="sd">    &gt;&gt;&gt;    font_col = &quot;grey20&quot;, # Color change option for fonts in chart</span>
<span class="sd">    &gt;&gt;&gt;    legend_pos = &quot;upper left&quot;, # Adjust the legend position using this parameter</span>
<span class="sd">    &gt;&gt;&gt;    legend_ncols = 1 # Adjust this parameter to 0 or 1 to change legend orientation from vertical to horizontal</span>
<span class="sd">    &gt;&gt;&gt;    )</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Only set default path if user didn&#39;t provide one</span>
    <span class="k">if</span> <span class="n">path</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;p2p&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="n">community</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">community</span><span class="p">)</span>
    
    <span class="c1"># `style` is currently a placeholder as only igraph is supported</span>
    <span class="c1"># legacy argument from the R implementation</span>
    <span class="n">style</span> <span class="o">=</span> <span class="s2">&quot;igraph&quot;</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">node_sizes</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`node_sizes` must be of length 2&quot;</span><span class="p">)</span>

    <span class="c1">#Set data frame for edges</span>
    <span class="k">if</span> <span class="n">weight</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">NoWeight</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">&quot;PrimaryCollaborator_PersonId&quot;</span><span class="p">,</span> <span class="s2">&quot;SecondaryCollaborator_PersonId&quot;</span><span class="p">,</span> <span class="s2">&quot;NoWeight&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;NoWeight&quot;</span><span class="p">:</span> <span class="s2">&quot;weight&quot;</span><span class="p">})</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">&quot;PrimaryCollaborator_PersonId&quot;</span><span class="p">,</span> <span class="s2">&quot;SecondaryCollaborator_PersonId&quot;</span><span class="p">,</span> <span class="n">weight</span><span class="p">]]</span>

    <span class="n">pc_hrvar</span> <span class="o">=</span> <span class="s2">&quot;PrimaryCollaborator_&quot;</span> <span class="o">+</span> <span class="n">hrvar</span>
    <span class="n">sc_hrvar</span> <span class="o">=</span> <span class="s2">&quot;SecondaryCollaborator_&quot;</span> <span class="o">+</span> <span class="n">hrvar</span>

    <span class="c1"># TieOrigin = PrimaryCollaborator</span>
    <span class="n">tieOrigin</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">edges</span><span class="p">[[</span><span class="s2">&quot;PrimaryCollaborator_PersonId&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
        <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="s2">&quot;PrimaryCollaborator_PersonId&quot;</span><span class="p">,</span> <span class="n">pc_hrvar</span><span class="p">]],</span> <span class="n">on</span> <span class="o">=</span> <span class="s2">&quot;PrimaryCollaborator_PersonId&quot;</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s2">&quot;left&quot;</span><span class="p">)</span> <span class="c1">#left join</span>
        <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;PrimaryCollaborator_PersonId&quot;</span><span class="p">:</span> <span class="s2">&quot;node&quot;</span><span class="p">})</span>
        <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">hrvar</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="n">pc_hrvar</span><span class="p">]})</span> <span class="c1">#assign new column</span>
        <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">pc_hrvar</span><span class="p">])</span> 
    <span class="p">)</span>

    <span class="c1"># TieDest = SecondaryCollaborator</span>
    <span class="n">tieDest</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">edges</span><span class="p">[[</span><span class="s2">&quot;SecondaryCollaborator_PersonId&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
        <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="s2">&quot;SecondaryCollaborator_PersonId&quot;</span><span class="p">,</span> <span class="n">sc_hrvar</span><span class="p">]],</span> <span class="n">on</span> <span class="o">=</span> <span class="s2">&quot;SecondaryCollaborator_PersonId&quot;</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s2">&quot;left&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;SecondaryCollaborator_PersonId&quot;</span><span class="p">:</span> <span class="s2">&quot;node&quot;</span><span class="p">})</span>
        <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">hrvar</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="n">sc_hrvar</span><span class="p">]})</span>
        <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">sc_hrvar</span><span class="p">])</span>
    <span class="p">)</span>

    <span class="c1"># Vertices data frame to provide meta-data</span>
    <span class="n">vert_ft</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">tieOrigin</span><span class="p">,</span> <span class="n">tieDest</span><span class="p">])</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>

    <span class="c1"># Create igraph object</span>
    <span class="n">g_raw</span> <span class="o">=</span> <span class="n">ig</span><span class="o">.</span><span class="n">Graph</span><span class="o">.</span><span class="n">TupleList</span><span class="p">(</span><span class="n">edges</span><span class="o">.</span><span class="n">itertuples</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span> <span class="n">directed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Assign vertex attributes - HR attribute and node</span>
    <span class="n">g_raw</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">hrvar</span><span class="p">]</span> <span class="o">=</span> <span class="n">vert_ft</span><span class="p">[</span><span class="n">hrvar</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">g_raw</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s2">&quot;node&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vert_ft</span><span class="p">[</span><span class="s2">&quot;node&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="c1"># Assign weights</span>
    <span class="n">g_raw</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">]</span>

    <span class="c1"># allowed community values</span>
    <span class="n">valid_comm</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;leiden&quot;</span><span class="p">,</span> <span class="s2">&quot;multilevel&quot;</span><span class="p">,</span> <span class="s2">&quot;edge_betweenness&quot;</span><span class="p">,</span> <span class="s2">&quot;fastgreedy&quot;</span><span class="p">,</span> <span class="s2">&quot;infomap&quot;</span><span class="p">,</span> <span class="s2">&quot;label_propagation&quot;</span><span class="p">,</span> <span class="s2">&quot;leading_eigenvector&quot;</span><span class="p">,</span> <span class="s2">&quot;optimal_modularity&quot;</span><span class="p">,</span> <span class="s2">&quot;spinglass&quot;</span><span class="p">,</span> <span class="s2">&quot;walk_trap&quot;</span><span class="p">]</span>

    <span class="c1"># Finalise `g` object</span>
    <span class="c1"># If community detection is selected, this is where the communities are appended</span>
    <span class="k">if</span> <span class="n">community</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        
        <span class="c1"># g = g_raw.simplify()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">g_raw</span> <span class="c1"># Note: NOT simplified as simplification may remove too many edges</span>
        <span class="n">v_attr</span> <span class="o">=</span> <span class="n">hrvar</span> 
        
    <span class="k">elif</span> <span class="n">community</span> <span class="ow">in</span> <span class="n">valid_comm</span><span class="p">:</span>
        <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">g_ud</span> <span class="o">=</span> <span class="n">g_raw</span><span class="o">.</span><span class="n">as_undirected</span><span class="p">()</span> <span class="c1"># Convert to undirected graph</span>
        
        <span class="c1"># combine arguments to clustering algorithms</span>
        <span class="n">comm_func</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ig</span><span class="o">.</span><span class="n">Graph</span><span class="p">,</span> <span class="s2">&quot;community_&quot;</span> <span class="o">+</span> <span class="n">community</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">comm_args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">comm_args</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># call community detection function</span>
        <span class="n">comm_out</span> <span class="o">=</span> <span class="n">comm_func</span><span class="p">(</span><span class="n">graph</span> <span class="o">=</span> <span class="n">g_ud</span><span class="p">,</span> <span class="o">**</span><span class="n">comm_args</span><span class="p">)</span>
        <span class="c1"># g = g_ud.simplify()</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">g_ud</span> <span class="c1"># Note: NOT simplified as simplification may remove too many edges</span>
        <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s2">&quot;cluster&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">member</span><span class="p">)</span> <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">comm_out</span><span class="o">.</span><span class="n">membership</span><span class="p">]</span>

        <span class="c1">#Name of vertex attribute</span>
        <span class="n">v_attr</span> <span class="o">=</span> <span class="s2">&quot;cluster&quot;</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please enter a valid input for `community`.&quot;</span><span class="p">)</span>
        
    <span class="c1"># centrality calculations ------------------------</span>
    <span class="c1"># valid values of `centrality`</span>
    <span class="n">valid_cent</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;betweenness&#39;</span><span class="p">,</span> <span class="s1">&#39;closeness&#39;</span><span class="p">,</span> <span class="s1">&#39;degree&#39;</span><span class="p">,</span> <span class="s1">&#39;eigenvector&#39;</span><span class="p">,</span> <span class="s1">&#39;pagerank&#39;</span><span class="p">]</span>  
    
    <span class="c1"># attach centrality calculations if `centrality` is not None</span>
    <span class="k">if</span> <span class="n">centrality</span> <span class="ow">in</span> <span class="n">valid_cent</span><span class="p">:</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">vi</span><span class="o">.</span><span class="n">network_summary</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">return_type</span><span class="o">=</span><span class="s2">&quot;network&quot;</span><span class="p">)</span>
        <span class="n">node_sizes</span> <span class="o">=</span> <span class="p">(</span><span class="n">node_sizes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">node_sizes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> 
        <span class="n">node_sizes</span> <span class="o">*=</span> <span class="n">minmax_scale</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">centrality</span><span class="p">])</span> <span class="o">+</span> <span class="n">node_sizes</span> <span class="c1">#min and max values</span>
        <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s2">&quot;node_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_sizes</span><span class="o">/</span><span class="mi">100</span> <span class="c1">#scale for plotting      </span>
    <span class="k">elif</span> <span class="n">centrality</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># all nodes with the same size if centrality is not calculated</span>
        <span class="c1"># adjust for plotting formats</span>
        <span class="k">if</span> <span class="n">style</span> <span class="o">==</span> <span class="s2">&quot;igraph&quot;</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s2">&quot;node_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.08</span><span class="p">]</span> <span class="o">*</span> <span class="n">g</span><span class="o">.</span><span class="n">vcount</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">style</span> <span class="o">==</span> <span class="s2">&quot;ggraph&quot;</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s2">&quot;node_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.08</span><span class="p">]</span> <span class="o">*</span> <span class="n">g</span><span class="o">.</span><span class="n">vcount</span><span class="p">()</span>
            <span class="n">node_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.03</span><span class="p">,</span><span class="mf">0.03</span><span class="p">]</span> <span class="c1">#fix node size</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please enter a valid input for `centrality`.&quot;</span><span class="p">)</span>

    <span class="c1"># Common area ------------------- ----------------</span>
    <span class="c1"># vertex table</span>
    <span class="n">vert_ft</span> <span class="o">=</span> <span class="n">vert_ft</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;node&quot;</span><span class="p">:</span> <span class="s2">&quot;name&quot;</span><span class="p">})</span>    
    
    <span class="k">if</span> <span class="n">centrality</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">community</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vert_tb</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                <span class="s2">&quot;betweenness&quot;</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s2">&quot;betweenness&quot;</span><span class="p">],</span>
                <span class="s2">&quot;closeness&quot;</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s2">&quot;closeness&quot;</span><span class="p">],</span>
                <span class="s2">&quot;degree&quot;</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s2">&quot;degree&quot;</span><span class="p">],</span>
                <span class="s2">&quot;eigenvector&quot;</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s2">&quot;eigenvector&quot;</span><span class="p">],</span>
                <span class="s2">&quot;pagerank&quot;</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s2">&quot;pagerank&quot;</span><span class="p">],</span>
            <span class="p">})</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">vert_tb</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                <span class="s2">&quot;cluster&quot;</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">v_attr</span><span class="p">],</span>
                <span class="s2">&quot;betweenness&quot;</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s2">&quot;betweenness&quot;</span><span class="p">],</span>
                <span class="s2">&quot;closeness&quot;</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s2">&quot;closeness&quot;</span><span class="p">],</span>
                <span class="s2">&quot;degree&quot;</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s2">&quot;degree&quot;</span><span class="p">],</span>
                <span class="s2">&quot;eigenvector&quot;</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s2">&quot;eigenvector&quot;</span><span class="p">],</span>
                <span class="s2">&quot;pagerank&quot;</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s2">&quot;pagerank&quot;</span><span class="p">],</span>
            <span class="p">})</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">community</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vert_tb</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
            <span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">vert_tb</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                <span class="s2">&quot;cluster&quot;</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">v_attr</span><span class="p">]</span>
            <span class="p">})</span>

    <span class="n">vert_tb</span> <span class="o">=</span> <span class="n">vert_tb</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">vert_ft</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s2">&quot;left&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span> <span class="c1">#merge hrvar to vertex table</span>
    
    <span class="n">g_layout</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">layout</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>

    <span class="n">out_path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%y%m</span><span class="si">%d</span><span class="s2">_%H%M%S&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.pdf&#39;</span>

    <span class="c1"># Return outputs ---------------------------------------</span>
    <span class="c1">#use fast plotting method</span>
    <span class="k">if</span> <span class="n">return_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;plot&quot;</span><span class="p">,</span> <span class="s2">&quot;plot-pdf&quot;</span><span class="p">]:</span>
        
        <span class="k">def</span><span class="w"> </span><span class="nf">rainbow</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;#</span><span class="si">{</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFFFFFF</span><span class="p">)</span><span class="si">:</span><span class="s2">06x</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>
            
        <span class="c1"># Set colours</span>
        <span class="n">vert_tb</span> <span class="o">=</span> <span class="n">vert_tb</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
        
        <span class="n">colour_tb</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="n">v_attr</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">v_attr</span><span class="p">]})</span>
             <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">colour</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">palette</span><span class="si">}</span><span class="s2">(len(vert_tb))&quot;</span><span class="p">))</span>
        <span class="p">)</span>

        <span class="c1"># Colour vector</span>
        <span class="n">colour_v</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="n">v_attr</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">v_attr</span><span class="p">]})</span>
            <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">colour_tb</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="n">v_attr</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s2">&quot;left&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;colour&quot;</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">style</span> <span class="o">==</span> <span class="s2">&quot;igraph&quot;</span><span class="p">:</span>
            <span class="c1"># Set graph plot colours</span>
            <span class="c1"># color_names = list(mcolors.CSS4_COLORS.keys())</span>
            <span class="c1"># g.vs[&quot;color&quot;] = [mcolors.to_rgba(color_names[i % len(color_names)], alpha=node_alpha) for i in range(len(g.vs))]</span>
    
            <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s2">&quot;frame_color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="c1">#Internal basic plotting function used inside &#39;network_p2p()&#39;</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">plot_basic_graph</span><span class="p">(</span><span class="n">lpos</span> <span class="o">=</span> <span class="n">legend_pos</span><span class="p">,</span> <span class="n">pdf</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">node_scale</span><span class="o">=</span><span class="n">node_scale</span><span class="p">):</span>
                
                <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span> <span class="k">if</span> <span class="n">figsize</span> <span class="k">else</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.facecolor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bg_fill</span>
                <span class="n">layout_func</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ig</span><span class="o">.</span><span class="n">Graph</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;layout_</span><span class="si">{</span><span class="n">layout</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                
                <span class="c1"># Get the unique values of the vertex attribute</span>
                <span class="n">unique_values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">v_attr</span><span class="p">]))</span>
                
                <span class="c1"># Create a colormap with one color for each unique value</span>
                <span class="n">cmap</span> <span class="o">=</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">([</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;tab20&#39;</span><span class="p">)(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_values</span><span class="p">))])</span>

                <span class="n">handles</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
                
                <span class="c1"># Map each unique value to an index in the colormap</span>
                <span class="n">value_to_index</span> <span class="o">=</span> <span class="p">{</span><span class="n">value</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_values</span><span class="p">)}</span>
                
                <span class="c1"># Legend</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_values</span><span class="p">):</span>
                    <span class="n">marker</span> <span class="o">=</span> <span class="n">mlines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="n">cmap</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
                    <span class="n">handles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">marker</span><span class="p">)</span>
                    <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                    
                <span class="c1"># Set node colours</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">v_attr</span><span class="p">]):</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="n">value_to_index</span><span class="p">[</span><span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">v_attr</span><span class="p">]]</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
                    <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">color</span>

                <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s2">&quot;node_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">*</span><span class="n">node_scale</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s2">&quot;node_size&quot;</span><span class="p">]]</span> <span class="c1"># scale the size of the nodes</span>
                
                <span class="n">ig</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="n">g</span><span class="p">,</span>
                    <span class="n">layout</span> <span class="o">=</span> <span class="n">layout_func</span><span class="p">(</span><span class="n">g</span><span class="p">),</span>
                    <span class="n">target</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                    <span class="n">vertex_label</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">vertex_size</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vs</span><span class="p">[</span><span class="s2">&quot;node_size&quot;</span><span class="p">],</span>
                    <span class="n">edge_arrow_mode</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                    <span class="n">edge_arrow_size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
                    <span class="n">edge_color</span> <span class="o">=</span> <span class="s2">&quot;#adadad&quot;</span><span class="p">,</span>
                <span class="p">)</span>              
                
                <span class="c1"># Number of legend columns</span>
                <span class="k">if</span> <span class="n">legend_ncols</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">handles</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">10</span><span class="p">:</span>
                        <span class="n">leg_cols</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">handles</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="mi">10</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">handles</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">20</span><span class="p">:</span>
                        <span class="n">leg_cols</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">handles</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">leg_cols</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">handles</span><span class="p">)</span> <span class="o">//</span> <span class="mi">4</span><span class="p">)</span>
                        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;There are over 20 unique node categories. Consider changing your grouping variable, merging existing groups, or tweaking algorithm parameters (if applicable).&quot;</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">leg_cols</span><span class="o">=</span><span class="mi">1</span>
                    
                <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
                    <span class="n">handles</span> <span class="o">=</span> <span class="n">handles</span><span class="p">,</span>
                    <span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">,</span>
                    <span class="n">handler_map</span><span class="o">=</span><span class="p">{</span><span class="nb">tuple</span><span class="p">:</span> <span class="n">HandlerTuple</span><span class="p">(</span><span class="n">ndivide</span><span class="o">=</span><span class="mi">20</span><span class="p">)},</span>
                    <span class="n">loc</span> <span class="o">=</span> <span class="n">legend_pos</span><span class="p">,</span>
                    <span class="n">edgecolor</span><span class="o">=</span> <span class="n">edge_col</span><span class="p">,</span>
                    <span class="n">frameon</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="n">markerscale</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="n">fontsize</span><span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
                    <span class="n">labelcolor</span> <span class="o">=</span> <span class="s1">&#39;grey&#39;</span><span class="p">,</span>
                    <span class="n">ncols</span> <span class="o">=</span> <span class="n">leg_cols</span>
                <span class="p">)</span>
    
                <span class="k">return</span> <span class="n">fig</span>

            <span class="c1"># Default PDF output unless None supplied to path</span>
            <span class="k">if</span> <span class="n">return_type</span> <span class="o">==</span> <span class="s2">&quot;plot&quot;</span><span class="p">:</span>
                
                <span class="k">return</span> <span class="n">plot_basic_graph</span><span class="p">(</span><span class="n">lpos</span> <span class="o">=</span> <span class="n">legend_pos</span><span class="p">)</span>
                
            <span class="k">elif</span> <span class="n">return_type</span> <span class="o">==</span> <span class="s2">&quot;plot-pdf&quot;</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">PdfPages</span><span class="p">(</span><span class="n">out_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">pdf</span><span class="p">:</span>
                    <span class="n">pdf</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plot_basic_graph</span><span class="p">(</span><span class="n">pdf</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saved to </span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid input for `style`.&quot;</span><span class="p">)</span>
    
    <span class="k">elif</span> <span class="n">return_type</span> <span class="o">==</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span>
        
        <span class="n">vert_tb</span> <span class="o">=</span> <span class="n">vert_tb</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> 
        
        <span class="k">return</span> <span class="n">vert_tb</span>
    
    <span class="k">elif</span> <span class="n">return_type</span> <span class="o">==</span> <span class="s2">&quot;network&quot;</span><span class="p">:</span>
        
        <span class="k">return</span> <span class="n">g</span>
    
    <span class="k">elif</span> <span class="n">return_type</span> <span class="o">==</span> <span class="s2">&quot;sankey&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">community</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Note: no sankey return option is available if `None` is selected at `community`. Please specify a valid community detection algorithm.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">community</span> <span class="ow">in</span> <span class="n">valid_comm</span><span class="p">:</span>
            <span class="n">vi</span><span class="o">.</span><span class="n">create_sankey</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">vert_tb</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">hrvar</span><span class="p">,</span> <span class="s1">&#39;cluster&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;n&#39;</span><span class="p">),</span> <span class="n">var1</span><span class="o">=</span><span class="n">hrvar</span><span class="p">,</span> <span class="n">var2</span><span class="o">=</span><span class="s1">&#39;cluster&#39;</span><span class="p">)</span>
    
    <span class="k">elif</span> <span class="n">return_type</span> <span class="o">==</span> <span class="s2">&quot;table&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">community</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">centrality</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">vert_tb</span> <span class="o">=</span> <span class="n">vert_tb</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">hrvar</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;n&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">vert_tb</span> <span class="o">=</span> <span class="n">vert_tb</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">hrvar</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span>
                    <span class="n">n</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;betweenness&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">),</span>
                    <span class="n">betweenness</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;betweenness&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">),</span>
                    <span class="n">closeness</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;closeness&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">),</span>
                    <span class="n">degree</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;degree&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">),</span>
                    <span class="n">eigenvector</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;eigenvector&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">),</span>
                    <span class="n">pagerank</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;pagerank&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="n">community</span> <span class="ow">in</span> <span class="n">valid_comm</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">centrality</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">vert_tb</span> <span class="o">=</span> <span class="n">vert_tb</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">hrvar</span><span class="p">,</span> <span class="s1">&#39;cluster&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;n&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">vert_tb</span> <span class="o">=</span> <span class="n">vert_tb</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">hrvar</span><span class="p">,</span> <span class="s1">&#39;cluster&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span>
                    <span class="n">n</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;betweenness&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">),</span>
                    <span class="n">betweenness</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;betweenness&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">),</span>
                    <span class="n">closeness</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;closeness&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">),</span>
                    <span class="n">degree</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;degree&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">),</span>
                    <span class="n">eigenvector</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;eigenvector&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">),</span>
                    <span class="n">pagerank</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;pagerank&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">)</span>
            <span class="p">)</span>
                
        <span class="k">return</span> <span class="n">vert_tb</span>
            
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;invalid input for `return_type`.&quot;</span><span class="p">)</span></div>

</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2026, Microsoft Corporation
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script src="../../_static/documentation_options.js?v=ff822928"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/furo.js?v=46bd48cc"></script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    </body>
</html>